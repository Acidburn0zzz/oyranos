Summary: Colour Management System
Name: oyranos
License: GPL
Group: Development/Libraries
URL: http://www.oyranos.org
Vendor: Kai-Uwe Behrmann
Packager: Kai-Uwe Behrmann <ku.b@gmx.de>
#BuildArch: %{_arch}
#%ifos linux
#Prereq: oyranos-LStarRGB oyranos-RGB oyranos-lcmsLAB oyranos-eci-offset2004
#%endif 
BuildRoot: %{_tmppath}/%{name}-root
Prefix:    %{_prefix}

%package   devel
Summary:   Headers, configuration and static libs + documentation
Group:     Development/System
Requires:  %{name}-%{version}-%{release}

%description
Oyranos is a colour management configuration system.
It is primarily developed on free operating systems.
Developers from other OSes can jump in the current
discussion to make Oyranos aware of cross platform
standards. Feel cordially invited to make constructive
suggestions.

Authors:
--------
    Oyranos     Kai-Uwe Behrmann <www.behrmann.name>

used components and libraries with divergine FOSS licenses:
    Elektra     Avi Alkalay and others
    md5         L. Peter Deutsch
    libXNVCtrl  Nvidia


%description devel
Oyranos is useable to store default profiles and paths and
query for profiles in that paths.
An internal device profile API allowes configuring of a 
profile in X.
The documentation in html format is included.


%prep
%setup -q -n %{name}-%{version}

%build
%configure --enable-debug

%install
rm -rf %{buildroot}
make
make DESTDIR=%{buildroot} install-main
rm -fr %{buildroot}/%{_datadir}/doc/%{name}

%clean
rm -rf %{buildroot}

%post
kdb=%{_bindir}/%{name}-kdb_static
kdb_found=`ls  | wc -l`
if [ "${kdb_found}" -gt 0 ]; then
  echo "`which ${kdb}` found"
fi
${kdb} set -c "test" user/sw/oy_install_test "1"
kdb_r=`${kdb} get user/sw/oy_install_test`;
if [ -n "${kdb_r}" ]; then
  if [ "`${kdb} get user/sw/oy_install_test`" -ne 1 ]; then
    kdb_found=0
    echo "keys not testable"
  fi
else
  kdb_found=0
fi
${kdb} rm user/sw/oy_install_test
if [ "${kdb_found}" -eq 0 ]; then
  echo "!!!WARNING!!! no useable kdb,"
  echo "              no check for Oyranos configuration possible"
fi
if [ "${kdb_found}" -gt 0 ]; then
  if [ "`${kdb} ls system/sw/oyranos 2>/dev/zero | wc -l`" -eq 0 ]; then
    #if [ "`${kdb} ls user/sw/oyranos 2>/dev/zero | wc -l`" -eq 0 ]; then
      echo "no oyranos keys found: set default policy home+office"
      oyranos-policy %{syscolordir}/%{settingsdirname}/office.policy.xml
    #fi
  else
    echo "Oyranos configuration is allready present. It is not touched here."
  fi
fi

%postun


%files
%defattr(-, root, root)
%doc AUTHORS COPYING ChangeLog README
%{_bindir}/%{name}-moni*
%{_bindir}/%{name}-config
%{_bindir}/%{name}-config-fl*
%{_bindir}/%{name}-policy
%{_bindir}/%{name}-kdb_static
%{_libdir}/lib%{name}*.so*
%{_mandir}/man1/%{name}*
%{_mandir}/man3/%{name}.*
%{_datadir}/locale/*/LC_MESSAGES/%{name}.*
%{syscolordir}/%{settingsdirname}/*.policy.xml
%{syscolordir}/cmms/*.oy_cmm_register.xml

%files devel
%defattr(-, root, root)
%doc AUTHORS COPYING ChangeLog README
%{_includedir}/%{name}/*.h
%{_libdir}/pkgconfig/*
%{_libdir}/*.a
%doc %{name}*.sh
%doc doc/html



%changelog
* Sat Sep 16 2006 Kai-Uwe Behrmann
- set default policy if no settings are found

* Sat May 28 2005 - Kai-Uwe Behrmann
- packaging

* Tue Apr 21 2005 Kai-Uwe Behrmann
- first release


